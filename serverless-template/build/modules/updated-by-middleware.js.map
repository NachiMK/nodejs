{"version":3,"sources":["../../src/modules/updated-by-middleware.js"],"names":["addUpdatedByToBody","event","authenticatedPersonPublicKey","requestContext","authorizer","claims","UpdatedBy","worker","getPerson","body","FirstName","LastName","addUpdatedDateToBody","UpdatedDate","Date","toISOString","addUpdatedKeysBody","id","stage","process","env","STAGE","table","config","tablePrefix","debug","personTable","create","indexName","getById"],"mappings":";;;;;;;AAAA;;;;;;AAEO,MAAMA,kDAAqB,MAAOC,KAAP,IAAiB;AACjD,QAAMC,+BAA+BD,MAAME,cAAN,CAAqBC,UAArB,CAAgCC,MAAhC,CAAuC,kBAAvC,CAArC;;AAEA,MAAI,CAACJ,MAAMK,SAAP,IAAoBJ,4BAAxB,EAAsD;AACpD,UAAMK,SAAS,MAAMC,UAAUN,4BAAV,CAArB;AACAD,UAAMQ,IAAN,CAAWH,SAAX,GAAwB,GAAEC,OAAOG,SAAU,IAAGH,OAAOI,QAAS,EAA9D;AACD;AACD,SAAOV,KAAP;AACD,CARM;;AAUA,MAAMW,sDAAuB,MAAOX,KAAP,IAAiB;AACnDA,QAAMQ,IAAN,CAAWI,WAAX,GAAyB,IAAIC,IAAJ,GAAWC,WAAX,EAAzB;AACA,SAAOd,KAAP;AACD,CAHM;;AAKA,MAAMe,kDAAqB,MAAOf,KAAP,IAAiB;AACjD,QAAMD,mBAAmBC,KAAnB,CAAN;AACA,QAAMW,qBAAqBX,KAArB,CAAN;AACD,CAHM;;AAKP,eAAeO,SAAf,CAAyBS,EAAzB,EAA6B;AAC3B,QAAMC,QAAQC,QAAQC,GAAR,CAAYC,KAA1B;;AAEAC,mBAAMC,MAAN,CAAa;AACXC,iBAAaN,KADF;AAEXO,WAAO;AAFI,GAAb;;AAKA,QAAMC,cAAcJ,iBAAMK,MAAN,CAAa,SAAb,EAAwB,EAAEC,WAAW,yBAAb,EAAxB,CAApB;;AAEA,SAAOF,YAAYG,OAAZ,CAAoBZ,EAApB,CAAP;AACD","file":"updated-by-middleware.js","sourcesContent":["import table from '@hixme/tables';\n\nexport const addUpdatedByToBody = async (event) => {\n  const authenticatedPersonPublicKey = event.requestContext.authorizer.claims['cognito:username'];\n\n  if (!event.UpdatedBy && authenticatedPersonPublicKey) {\n    const worker = await getPerson(authenticatedPersonPublicKey);\n    event.body.UpdatedBy = `${worker.FirstName} ${worker.LastName}`;\n  }\n  return event;\n};\n\nexport const addUpdatedDateToBody = async (event) => {\n  event.body.UpdatedDate = new Date().toISOString();\n  return event;\n};\n\nexport const addUpdatedKeysBody = async (event) => {\n  await addUpdatedByToBody(event);\n  await addUpdatedDateToBody(event);\n};\n\nasync function getPerson(id) {\n  const stage = process.env.STAGE;\n\n  table.config({\n    tablePrefix: stage,\n    debug: false,\n  });\n\n  const personTable = table.create('persons', { indexName: 'EmployeePublicKey-index' });\n\n  return personTable.getById(id);\n}\n"]}