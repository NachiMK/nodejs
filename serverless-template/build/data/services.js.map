{"version":3,"sources":["../../src/data/services.js"],"names":["getService","getServicesByDomain","saveService","id","serviceTable","createTable","getById","domain","domains","queryByKeys","Domain","filter","f","IsActive","service","Id","uuid","v4","UpdatedDate","Date","toISOString","put","Item","stage","process","env","STAGE","table","config","tablePrefix","debug","create","indexName"],"mappings":";;;;;QAIsBA,U,GAAAA,U;QAMAC,mB,GAAAA,mB;QAQAC,W,GAAAA,W;;AAlBtB;;AACA;;;;AACA;;;;;;AAEO,eAAeF,UAAf,CAA0BG,EAA1B,EAA8B;AACnC,QAAMC,eAAeC,aAArB;;AAEA,SAAOD,aAAaE,OAAb,CAAqBH,EAArB,CAAP;AACD;;AAEM,eAAeF,mBAAf,CAAmCM,MAAnC,EAA2C;AAChD,QAAMH,eAAeC,aAArB;;AAEA,QAAMG,UAAU,MAAMJ,aAAaK,WAAb,CAAyB,EAAEC,QAAQH,MAAV,EAAzB,CAAtB;;AAEA,SAAO,qBAAQC,QAAQG,MAAR,CAAgBC,CAAD,IAAOA,EAAEC,QAAxB,CAAR,EAA2C,MAA3C,CAAP;AACD;;AAEM,eAAeX,WAAf,CAA2BY,OAA3B,EAAoC;AACzC,QAAMV,eAAeC,aAArB;;AAEAS,UAAQC,EAAR,GAAaD,QAAQC,EAAR,IAAcC,eAAKC,EAAL,EAA3B;AACAH,UAAQI,WAAR,GAAsB,IAAIC,IAAJ,GAAWC,WAAX,EAAtB;;AAEA,SAAOhB,aAAaiB,GAAb,CAAiB,EAAEC,MAAMR,OAAR,EAAjB,CAAP;AACD;;AAED,SAAST,WAAT,GAAuB;AACrB,QAAMkB,QAAQC,QAAQC,GAAR,CAAYC,KAA1B;;AAEAC,mBAAMC,MAAN,CAAa;AACXC,iBAAaN,KADF;AAEXO,WAAO;AAFI,GAAb;;AAKA,SAAOH,iBAAMI,MAAN,CAAa,UAAb,EAAyB,EAAEC,WAAW,cAAb,EAAzB,CAAP;AACD","file":"services.js","sourcesContent":["import { orderBy } from 'lodash';\nimport uuid from 'uuid';\nimport table from '@hixme/tables';\n\nexport async function getService(id) {\n  const serviceTable = createTable();\n\n  return serviceTable.getById(id);\n}\n\nexport async function getServicesByDomain(domain) {\n  const serviceTable = createTable();\n\n  const domains = await serviceTable.queryByKeys({ Domain: domain });\n\n  return orderBy(domains.filter((f) => f.IsActive), 'Name');\n}\n\nexport async function saveService(service) {\n  const serviceTable = createTable();\n\n  service.Id = service.Id || uuid.v4();\n  service.UpdatedDate = new Date().toISOString();\n\n  return serviceTable.put({ Item: service });\n}\n\nfunction createTable() {\n  const stage = process.env.STAGE;\n\n  table.config({\n    tablePrefix: stage,\n    debug: false,\n  });\n\n  return table.create('services', { indexName: 'Domain-index' });\n}\n"]}