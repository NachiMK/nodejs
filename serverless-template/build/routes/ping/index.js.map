{"version":3,"sources":["../../../src/routes/ping/index.js"],"names":["ping","before","event","env","npm_package_version","STAGE","versions","node","process","result","message","showENV","params","eventHeadersHost","headers","Host","HTTPRequestPassingThroughHixmeDomain","includes","serviceIsRuningLocally","isOffline","isSafeToDisplayEnvVariables","isProd","showEvent","after"],"mappings":";;;;;;;AAAA;;;;AACA;;AACA;;AACA;;;;AAEO,MAAMA,sBAAO,wBAClBC,6BADkB,EAElB,MAAOC,KAAP,IAAiB;AACf,QAAM;AAEJC,SAAK,EAAEC,mBAAF,EAAuBC,KAAvB,KAAiC,EAFlC;AAGJC,cAAU,EAAEC,IAAF,KAAW;AAHjB,MAIFC,OAJJ;;AAMA,QAAMF,WAAW,EAAEC,IAAF,EAAQH,mBAAR,EAAjB;;AAEAF,QAAMO,MAAN,GAAe;AACbC,aAAS,OADI;AAEbL,SAFa;AAGbC;AAHa,GAAf;;AAOA,QAAM,EAAEK,OAAF,KAAcT,MAAMU,MAA1B;;AAEA,QAAMC,mBAAmBX,MAAMY,OAAN,IAAiBZ,MAAMY,OAAN,CAAcC,IAAxD;AACA,QAAMC,uCACJH,oBAAoBA,iBAAiBI,QAAjB,CAA0B,WAA1B,CADtB;AAEA,QAAMC,yBAAyB,CAACF,oCAAD,IAAyCd,MAAMiB,SAA9E;;AAEA,QAAMC,8BAA8B,CAACC,uBAAD,IAAWH,sBAA/C;;AAGA,MAAIE,+BAA+B,wCAAkBT,OAAlB,CAAnC,EAA+D;AAC7DT,UAAMO,MAAN,CAAaN,GAAb,GAAmBK,QAAQL,GAA3B;AACD;AACF,CA/BiB,EAgClBmB,8BAhCkB,EAiClBC,4BAjCkB,CAAb","file":"index.js","sourcesContent":["import ware from 'warewolf';\nimport { before, after } from '@hixme/before-after-middleware';\nimport { showEvent } from '../../modules/show-event-middleware';\nimport { isProd, queryStringIsTrue } from '../../modules/serverless-utils';\n\nexport const ping = ware(\n  before,\n  async (event) => {\n    const {\n      // eslint-disable-next-line camelcase\n      env: { npm_package_version, STAGE } = {},\n      versions: { node } = {},\n    } = process;\n\n    const versions = { node, npm_package_version };\n\n    event.result = {\n      message: 'pong!',\n      STAGE,\n      versions,\n    };\n\n    // if `showEvent` query-string is set, then add the entire event\n    const { showENV } = event.params;\n\n    const eventHeadersHost = event.headers && event.headers.Host;\n    const HTTPRequestPassingThroughHixmeDomain =\n      eventHeadersHost && eventHeadersHost.includes('hixme.com');\n    const serviceIsRuningLocally = !HTTPRequestPassingThroughHixmeDomain || event.isOffline;\n    // NOTE: `event.isOffline` is a serverless-added boolean and it's quite helpful\n    const isSafeToDisplayEnvVariables = !isProd && serviceIsRuningLocally;\n\n    // if `showENV` query-string is set, then add all environment variables\n    if (isSafeToDisplayEnvVariables && queryStringIsTrue(showENV)) {\n      event.result.env = process.env;\n    }\n  },\n  showEvent,\n  after\n);\n"]}